sudo: required

services:
  - docker

before_install:
  - set -e

env:
  - GITLAB_VERSION=10.2.2
  - GITLAB_VERSION=10.2.8 # latest 10.2.x
  - GITLAB_VERSION=10.3.7 # latest 10.3.x
  - GITLAB_VERSION=10.4.3 # latest 10.4.x

script:
  - image_name="inovex/gitlab:${GITLAB_VERSION?}-${TRAVIS_COMMIT:0:7}"
  - docker build --pull --build-arg "GITLAB_VERSION=${GITLAB_VERSION?}" --tag ${image_name?} .
  - if [[ "${TRAVIS_BRANCH?}" == "master" && "${TRAVIS_PULL_REQUEST?}" == "false" ]]; then
    docker login -u "${DOCKER_USERNAME?}" -p "${DOCKER_PASSWORD?}";
    docker push ${image_name?};
    fi
